### *NMAP (Network Mapper)*
*NMAP* — инструмент для исследования сети и провеки безопасности. Аналоги: *Masscan*, *Zmap*.

Методы сканирования хостов:
- *ICMP (ping)*. На указанный *IP*-адрес высылаются пакет типа *ICMP Echo REQUEST*. В случае ответа в виде пакета типа *ICMP Echo REPLY* считается, что узел присутствует в сети;

Методы сканирования портов:
- *TCP SYN* - сканирование с установлением полуоткрытого соединения. Клиент отправляет *TCP*-сегмент с *SYN*-флагом, если в ответе от сервера установлены *SYN,ACK*-флаги, то считается, что порт открыт. В случае ответного сегмента с флагом *RST* - порт закрыт. Также может возникнуть ситуация при котрой не приходит никакого ответа либо приходит, но не стандартный *SYN,ACK*, тогда считается, что порт фильтруется;
- *TCP CONNECT* - сканирование с установлением полного соединения. ~~Кажется... этот метод отличается от *TCP SYN* тем, что на стороне клиента вызывается системный вызов *connect()*, резервирующий ресурсы на стороне клиента + соединение устанавливается на уровне ОС ???.~~ Также при данном методе сканирования клиент в ответ на *SYN,ACK* сервера, отправит *TCP*-сегмент с флагом *ACK*;
- *UDP*. Клиентом отправляется *UDP*-дейтаграмма, пустая в большенстве случаев. В случае любого *UDP*-ответа считается, что порт открыт, в случае отстутсвия ответа открыт/отфильтрова, закрыт - *ICMP port unreachable error* и отфильтрован - *Other ICMP unreachable errors*. Медленнее чем *TCP*-сканирование, например, *UDP*-порты 1-65535 займет ~18 часов;

- *TCP ACK*. В запросе от клиента установлен только *ACK*-флаг. Открытые/закрытые порты вернут *RST*-флаг в ответе. Порты, которые не отвечают или посылают в ответ *ICMP Destination Unreachable* с определенными кодами считаются фильтруемыми. Сканирование используется для выявления фильтруемых портов;
   
В отдельную группу можно выделить методы, которые заключаются в отправке пакетов с специфичными флагами в *TCP*-заголовке. Методы основаны на особенности спецификации *RFC 793*:
- *TCP NULL, FIN, Xmas*.



### Как защититься от сканирования портов и *Shodan*?
Сканирование на наличие открытых портов третьими лицами может использоваться для подготовки целевых атак на сервисы компании. В связи с чем становится актуальным вопрос того, как стать невидымым для поисковых систем *Shodan*, *Censys*.

Противодействие можно обеспечить при помощи: 1) *iptables*; 2) *ipset*; 3) *rsyslog; 4) Готовые решения, например, *CloudFlare*. Важным является следующий вопрос: "Злоумышленник может целенаправленно банить легитимные *IP*-адреса, что делать в таком случае?". 

При помощи *NATS Messaging* можно организовать синхранизацию между серверами, чтобы во время атаки передаввть адрес злоумышленника с одного сервера на другие. Подобные системы часто организованы в виде ханипотов, расположенных в разных регионах. Они агрегируют атакующие *IP*-адреса, клиенты подобных решений могут использовать подобные списки.

На втором этапе защиты от атаки могут использоваться утилиты по типу *fail2ban* (которые парсят логи и на основе сообщений от разных демонов блокируют *IP*-адреса, подозревающиеся в подозрительной активности), *Denyhosts*.



### Ссылки
1. [Как защититься от сканирования портов и *Shodan*?](https://habr.com/ru/articles/686120/)
2. [mkfifo /var/log/iptables.pipe](https://ru.wikipedia.org/wiki/%D0%98%D0%BC%D0%B5%D0%BD%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D1%8B%D0%B9_%D0%BA%D0%B0%D0%BD%D0%B0%D0%BB)
3. [Одноранговая сеть](https://ru.wikipedia.org/wiki/%D0%9E%D0%B4%D0%BD%D0%BE%D1%80%D0%B0%D0%BD%D0%B3%D0%BE%D0%B2%D0%B0%D1%8F_%D1%81%D0%B5%D1%82%D1%8C)
4. [Прочитай и сделай: проводим сканирование сети самостоятельно](https://habr.com/ru/companies/pt/articles/513776/)
